@{
    Layout = "~/_SiteLayout.cshtml";

    Business.Platform.WorkFlowTask bworkFlowTask = new Business.Platform.WorkFlowTask();
    Business.Platform.WorkFlow bworkFlow = new Business.Platform.WorkFlow();

    string title = "";
    string flowid = "";
    string sender = "";
    string date1 = "";
    string date2 = "";
    string status = "";
    
    if(IsPost)
    {
        title = Request.Form["Title"];
        flowid = Request.Form["FlowID"];
        sender = Request.Form["SenderID"];
        date1 = Request.Form["Date1"];
        date2 = Request.Form["Date2"];
        status = Request.Form["Status"];
    }
    else
    {
        title = Request.QueryString["Title"];
        flowid = Request.QueryString["FlowID"];
        sender = Request.QueryString["SenderID"];
        date1 = Request.QueryString["Date1"];
        date2 = Request.QueryString["Date2"];
        status = Request.QueryString["Status"];
    }

    string query = string.Format("&appid={0}&tabid={1}&title={2}&flowid={3}&sender={4}&date1={5}&date2={6}&status={7}&pagesize={8}&pagenumber={9}",
        Request.QueryString["appid"], Request.QueryString["tabid"], title.UrlEncode(), flowid, sender, date1, date2, status,
        Request.QueryString["pagesize"], Request.QueryString["pagenumber"]);
        
    string pager;
    
    List<SelectListItem> statusItems=new List<SelectListItem>();
    statusItems.Add(new SelectListItem() { Text = "未完成", Value = "0", Selected = "0" == status });
    statusItems.Add(new SelectListItem() { Text = "已完成", Value = "1", Selected = "1" == status });

    string flowOptions = bworkFlow.GetOptions(flowid);
    
    //可管理的流程ID数组
    Guid[] manageFlows = new Guid[] { };

    var taskList = bworkFlowTask.GetInstances(manageFlows, new Guid[] { },
        sender.IsNullOrEmpty() ? new Guid[] { } : new Guid[] { sender.Replace(Business.Platform.Users.PREFIX, "").ToGuid() },
        out pager, query, title, flowid, date1, date2, "1" == status);
}
<form action="" method="post" >
<div class="querybar">
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
        <tr>
            <td>
                标题：<input type="text" class="mytext" id="Title" style="width:120px;" name="Title" value="@title" />
                所属流程：<select class="myselect" style="width:130px;" id="FlowID" name="FlowID"><option value="">==全部==</option>@Html.Raw(flowOptions)</select>
                发送人：<input type="text" style="width:80px;"  class="mymember" id="SenderID" unit="0" dept="0" station="0" user="1" group="0" more="0" name="SenderID" value="@sender"  />
                发送时间：<input type="text" class="mycalendar" value="@date1" style="width:90px;" name="Date1" /> 至 <input type="text" style="width:90px;" value="@date2" class="mycalendar" name="Date2" />
                状态：@Html.DropDownList("Status", statusItems, new {@class="myselect"})
                <input type="submit" name="Search" value="查询" class="mybutton" />
            </td>
        </tr>
    </table>
</div>
<table cellpadding="0" cellspacing="1" border="0" class="listtable">
    <thead>
        <tr>
            <th>标题</th>
            <th>所属流程</th>
            <th>所在步骤</th>
            <th>处理者</th>
            <th>接收时间</th>
            <th>当前状态</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
   @foreach (var task in taskList)
    {
        string flowName;
        string stepName = bworkFlow.GetStepName(task.StepID, task.FlowID, out flowName);
        string query1 = string.Format("flowid={0}&stepid={1}&instanceid={2}&taskid={3}&groupid={4}&appid={5}&display=1",
             task.FlowID, task.StepID, task.InstanceID, task.ID, task.GroupID, Request.QueryString["appid"]
             );
        string timeout = string.Empty;// task.CompletedTime.HasValue && task.CompletedTime.Value < Utility.DateTimeNew.Now ? "<span style='color:red;'>(已超时)<span>" : "";
        <tr>
            <td><a href="javascript:void(0);" onclick="openTask('/Platform/WorkFlow/Run/Default?@Html.Raw(query1)','@task.Title','@task.ID');return false;" class="blue">@task.Title</a></td>
            <td>@flowName</td>
            <td>@stepName</td>
            <td>@task.ReceiveName</td>
            <td>@task.ReceiveTime</td>
            <td>@bworkFlowTask.GetStatusTitle(task.Status)@Html.Raw(timeout)</td>
            <td>
                <a style="margin-right:3px; background:url(/Images/ico/Properties.png) no-repeat left center; padding-left:18px;" href="javascript:void(0);" onclick="manage('@task.FlowID','@task.GroupID');">管理</a>
                <a style="margin-right:3px; background:url(/Images/ico/trash.gif) no-repeat left center; padding-left:18px;" href="javascript:void(0);" onclick="delete1('@task.FlowID','@task.GroupID');">删除</a>
            </td>
        </tr>
    }
    </tbody>
</table>
<div class="buttondiv">@Html.Raw(pager)</div>
</form>
<script type="text/javascript">
    function openTask(url, title, id)
    {
        top.openApp(url, 0, title, id, 0, 0, false);
    }
    function manage(flowid, groupid)
    {
        top.mainDialog.open({ url: '/Platform/WorkFlow/Tasks/InstanceManage?flowid1=' + flowid + "&groupid=" + groupid + '@Html.Raw(query)',
            width: 800, height: 400, title: "管理流程实例"
        });
    }
    function delete1(flowid, groupid)
    {
        if (confirm("您真的要删除该流程实例吗?"))
        {
            $.ajax({ url: "/Platform/WorkFlow/Tasks/Delete?flowid1=" + flowid + "&groupid=" + groupid, async: false, cache:false, success: function (txt)
            {
                alert(txt);
                window.location = window.location;
            }
            });
        }
    }
</script>